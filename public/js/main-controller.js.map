{"version":3,"sources":["main-controller.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main-controller.js","sourcesContent":["var app = angular.module('mainapp', []);\napp.controller('MainController', ['$scope', '$http', function($scope, $http) {\n    $scope.micelist = [];\n    $scope.search_results = [];\n    $scope.first_load = true;\n    $scope.mice_found = 0;\n    // Get locations and cheese for each mouse\n    $scope.search = function() {\n        $('#custom_loader').show();\n        $scope.search_results = [];\n        $scope.mice_not_found = [];\n        $scope.mice_found = 0;\n\n        $http.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';\n        $http.get(\"search\", {\n            params: {\n                mice: JSON.stringify($scope.micelist),\n            }\n        }).success(function(response) {\n            console.log(response);\n            var structured_locations = {};\n            // build location objects from mice objects in response\n            angular.forEach(response, function(mouse) {\n                if (mouse.is_valid) {\n                    $scope.mice_found++;\n                    angular.forEach(mouse.locations, function(location, location_id) {\n                        if (!structured_locations.hasOwnProperty(location.name)) {\n                            structured_locations[location.name] = {};\n                            structured_locations[location.name].mice = {};\n                            structured_locations[location.name].stages ={};\n                        }\n                        if (!structured_locations[location.name].stages.hasOwnProperty(location.stage)) {\n                            structured_locations[location.name].stages[location.stage] = {};\n                            structured_locations[location.name].stages[location.stage].mice = [];\n                            structured_locations[location.name].stages[location.stage].size = 0;\n                            structured_locations[location.name].stages[location.stage].id = location_id;\n                        }\n                        structured_locations[location.name].name = location.name;\n\n                        var cheeses = [];\n                        angular.forEach(mouse.cheeses, function(cheese) {\n                            cheeses.push(cheese);\n                        });\n                        structured_locations[location.name].stages[location.stage].mice.push({\n                            name: mouse.name,\n                            mouse_wiki_url: mouse.mouse_wiki_url,\n                            cheeses: cheeses\n                        });\n\n                        structured_locations[location.name].mice[mouse.name] = true;\n                        structured_locations[location.name].size = Object.keys(structured_locations[location.name].mice).length;\n                    });\n                } else if (mouse.name != '') {\n                    $scope.mice_not_found.push({\n                        name: mouse.name\n                    });\n                }\n            });\n\n            // populate $scope.search_results grouped by location\n            angular.forEach(structured_locations, function(location) {\n                $scope.search_results.push(location);\n            });\n\n            $('#custom_loader').fadeOut('slow');\n            $scope.first_load = false;\n        })\n        .error(function(response) {\n            alert(\"Failed to reach server, please try again later.\");\n            console.log(response);\n        });\n    };\n    // Reset everything\n    $scope.reset = function() {\n        $scope.micelist = [];\n        $scope.search_results = [];\n        $scope.first_load = true;\n        $scope.mice_not_found = [];\n        $scope.mice_found = 0;\n    };\n    // Remove a mouse from list\n    $scope.remove_a_mouse = function(mouse_name) {\n        angular.forEach($scope.search_results, function(location) {\n            var reduce_location = false;\n            angular.forEach(location.stages, function(stage, stage_name) {\n                angular.forEach(stage.mice, function(mouse, key) {\n                    if (mouse.name === mouse_name) {\n                        stage.mice.splice(key, 1);\n                        reduce_location = true;\n                    }\n                });\n            });\n            if (reduce_location) location.size--;\n        });\n        $scope.mice_found--;\n    };\n    $scope.toggle_stage = function(id) {\n        $('#stage' + id).toggleClass(\"hide_class\", 0);\n    };\n}]);\n"],"sourceRoot":"/source/"}